{% extends "base.html" %}
{% block content %}
{% load static %}
<!-- Regular Bath Page -->
<section class="text-center text-white d-flex align-items-center" 
         style="background: url('/static/images/REGULAR-1.png') no-repeat center center/cover; min-height: 700px;">
  <div class="container py-5">
    <h1 class="display-3 fw-bold" style="color: #e75b1e;">
      Regular <br>
      <span class="fs-2" style="color: #e75b1e;">Bath</span>
    </h1>
  </div>
</section>

<section class="py-5 bg-light">
  <div class="container">
    <div class="row g-5">
      <!-- Left Section -->
      <div class="col-lg-8">
        <h2 class="fw-bold text-danger">Regular Bath</h2>
        <div class="d-flex align-items-start gap-3 mb-3">
          <img src="{% static 'Images/REGULAR-2.png' %}" alt="Thumb" class="rounded" width="120">
          <div>
            <h6 class="text-danger fw-bold mb-0">Best For All Kinds Of Dogs & Cats</h6>
            <p class="text-muted small mb-0">
              Giving your pet regular baths is important for their overall cleanliness and well-being. It helps get rid of dirt, keeps their fur looking healthy, and removes unpleasant smells. Always use a gentle, pet-safe shampoo with warm water to make the bath a pleasant experience.
            </p>
            <p class="text-muted small">
              Frequent bathing is especially beneficial for pets that spend a lot of time outdoors or tend to get dirty often.
            </p>
            <p class="text-muted small">
              Our grooming services include: double bathing, conditioning, towel and dryer blow-drying, thorough combing and brushing, hygiene care, trimming and tidying of hair, nail clipping, paw pad trimming and shaving, ear and eye cleaning, and a refreshing cologne spray.
            </p>
          </div>
        </div>

        <h5 class="text-center text-danger mt-5 fw-bold">SIZE REFERENCE CHART BY BREED</h5>
        <div class="row text-center mt-4 g-4">
          <div class="col-md-4">
            <div class="card h-100 border-0 shadow rounded-4">
              <div class="card-body">
                <h5 class="fw-bold text-danger">Small</h5>
                <p class="text-muted">1 to 10 Kg</p>
                <small class="text-muted d-block">Chihuahua, Japanese spitz, Maltese, Papillon, Pomeranian, Poodle, Yorkshire Terrier, Basenji Beagle, Bichon Frise, Corgi, Dachshund, French Bulldog, Miniature Pinscher</small>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="card h-100 border-0 shadow rounded-4">
              <div class="card-body">
                <h5 class="fw-bold text-danger">Medium</h5>
                <p class="text-muted">11 to 25 Kg</p>
                <small class="text-muted d-block">Japanese spitz, Border Collie, Brittany, Bull Dog, Bull Terrier, Chow Chow, Cocker Spaniel, Dalmatian, Siberian Husky, White Breed Pitbull, Apso, Poodle Standard</small>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="card h-100 border-0 shadow rounded-4">
              <div class="card-body">
                <h5 class="fw-bold text-danger">Large</h5>
                <p class="text-muted">26 to 45 Kg</p>
                <small class="text-muted d-block">Afghan Hound, Boxer, Doberman, Siberian Husky, German Shepherd, Golden Retriever, Greyhound, Labrador Retriever, Rottweiler, Himalayan Mastiff, Dalmatian</small>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Section -->
      <div class="col-lg-4">
        <div class="card shadow-sm border-0 rounded-4 p-4">
          <img src="{% static 'Images/REGULAR-3.png' %}" alt="Service" class="rounded mb-4 w-100">
          <div class="text-muted small mb-3">
            <p><strong class="text-danger">üí≤ Price:</strong><br>Rs. 1800 / Rs. 2000 / Rs. 2500</p>
            <p><strong class="text-danger">üêæ Pets Size:</strong><br>Small / Medium / Large</p>
            <p><strong class="text-danger">üë§ Service By:</strong><br>Little Heart Pet‚Äôs Staff</p>
            <p><strong class="text-danger">‚è± Duration:</strong><br>1 Hour</p>
            <p><strong class="text-danger">ü©∫ Suitable For:</strong><br>All Kinds of Dog & Cats</p>
            <p><strong class="text-danger">üïí Working Hours:</strong><br>10 AM TO 6 PM (Sun - Fri)</p>
            <p><strong class="text-danger">üí≥ Payment Method:</strong><br>Cash or Online</p>
            <p><strong class="text-danger">üìû Contact No:</strong><br>+977 9800000000</p>
          </div>
          <a href="#" class="btn btn-outline-danger w-100" data-bs-toggle="modal" data-bs-target="#bookingModal">Book Now ‚Üí</a>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Booking Modal -->
<div class="modal fade" id="bookingModal" tabindex="-1" aria-labelledby="bookingModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="bookingModalLabel">Book Your Pet Grooming</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="bookingForm">
          <div id="step1" class="step active">
            <h4>Customer Details</h4>
            <div class="mb-3">
              <label for="fullName" class="form-label">Full Name</label>
              <input type="text" class="form-control" id="fullName" name="full_name" required>
            </div>
            <div class="mb-3">
              <label for="contactNo" class="form-label">Contact No <span class="text-danger">*</span></label>
              <input type="tel" class="form-control" id="contactNo" name="contact_no" required>
            </div>
            <div class="mb-3">
              <label for="email" class="form-label">Email Address <span class="text-danger">*</span></label>
              <input type="email" class="form-control" id="email" name="email" required>
            </div>
            <button type="button" class="btn btn-primary" id="nextStep1">Next</button>
          </div>

          <div id="step2" class="step">
            <h4>Pet Info</h4>
            <div id="petContainer">
              <div class="pet-info mb-3">
                <label for="petName1" class="form-label">Pet Name</label>
                <input type="text" class="form-control" id="petName1" name="petName1" required>
                <label for="petAge1" class="form-label">Age</label>
                <input type="number" class="form-control" id="petAge1" name="petAge1">
                <label for="petWeight1" class="form-label">Weight <span class="text-danger">*</span></label>
                <input type="number" class="form-control" id="petWeight1" name="petWeight1" step="0.1" required>
                <label for="petNote1" class="form-label">Note (Medical Condition, Behavior)</label>
                <textarea class="form-control" id="petNote1" name="petNote1"></textarea>
              </div>
            </div>
            <button type="button" class="btn btn-secondary" id="addPet">Add Another Pet</button>
            <button type="button" class="btn btn-primary" id="nextStep2">Next</button>
            <button type="button" class="btn btn-secondary" id="prevStep2">Previous</button>
          </div>

          <div id="step3" class="step">
            <h4>Grooming Booking</h4>
            <div class="mb-3">
              <label class="form-label">Service Type</label>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="service_type" id="washDry" value="washDry" required>
                <label class="form-check-label" for="washDry">Wash and Dry (Rs. 1800)</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="service_type" id="washTidy" value="washTidy">
                <label class="form-check-label" for="washTidy">Wash and Tidy (Rs. 2000)</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="service_type" id="fullGroom" value="fullGroom">
                <label class="form-check-label" for="fullGroom">Full Groom (Rs. 2500)</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="service_type" id="puppy" value="puppy">
                <label class="form-check-label" for="puppy">Puppy (Rs. 2000)</label>
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label">Add-ons</label>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="add_ons" id="deshedding" value="deshedding">
                <label class="form-check-label" for="deshedding">Deshedding (Rs. 500) - Wash and Tidy/Dry</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="add_ons" id="specialShampoo" value="specialShampoo">
                <label class="form-check-label" for="specialShampoo">Special Shampoo (Rs. 300) - All</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="add_ons" id="nailClip" value="nailClip">
                <label class="form-check-label" for="nailClip">Nail Clip (Rs. 200) - Wash and Dry</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="add_ons" id="analGland" value="analGland">
                <label class="form-check-label" for="analGland">Anal Gland (Rs. 400) - All</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="add_ons" id="teethBrushing" value="teethBrushing">
                <label class="form-check-label" for="teethBrushing">Teeth Brushing (Rs. 300) - All</label>
              </div>
            </div>
            <div class="mb-3">
              <label for="dateTime" class="form-label">Date and Time (9 AM - 5 PM)</label>
              <input type="datetime-local" class="form-control" id="dateTime" name="date_time" required>
            </div>
            <p><strong>Total Price: </strong><span id="totalPrice">Rs. 0.00</span></p>
            <button type="button" class="btn btn-primary" id="confirmBooking">Confirm Booking</button>
            <button type="button" class="btn btn-secondary" id="prevStep3">Previous</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Bootstrap JS and Popper.js -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>

<!-- JavaScript for Booking Form -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const modal = new bootstrap.Modal(document.getElementById('bookingModal'));
    let petCount = 1;

    // Show modal and set date range
    document.querySelector('.btn-outline-danger').addEventListener('click', function() {
      modal.show();
      document.getElementById('step1').classList.add('active');
      const today = new Date().toISOString().slice(0, 16);
      const oneMonthLater = new Date(new Date().setMonth(new Date().getMonth() + 1)).toISOString().slice(0, 16);
      document.getElementById('dateTime').setAttribute('min', today);
      document.getElementById('dateTime').setAttribute('max', oneMonthLater);
      document.querySelectorAll('.step').forEach(step => step.style.display = 'none');
      document.querySelector('.step.active').style.display = 'block';
    });

    // Step Navigation
    document.getElementById('nextStep1').addEventListener('click', function() {
      if (document.getElementById('contactNo').value && document.getElementById('email').value) {
        document.getElementById('step1').classList.remove('active');
        document.getElementById('step2').classList.add('active');
        document.querySelectorAll('.step').forEach(step => step.style.display = 'none');
        document.querySelector('.step.active').style.display = 'block';
      } else {
        alert('Full Name, Contact No, and Email are required!');
      }
    });

    document.getElementById('nextStep2').addEventListener('click', function() {
      let valid = true;
      for (let i = 1; i <= petCount; i++) {
        if (!document.getElementById(`petWeight${i}`).value) {
          valid = false;
          break;
        }
      }
      if (valid) {
        document.getElementById('step2').classList.remove('active');
        document.getElementById('step3').classList.add('active');
        document.querySelectorAll('.step').forEach(step => step.style.display = 'none');
        document.querySelector('.step.active').style.display = 'block';
        updateTotalPrice();
      } else {
        alert('Weight is required for all pets!');
      }
    });

    document.getElementById('prevStep2').addEventListener('click', function() {
      document.getElementById('step2').classList.remove('active');
      document.getElementById('step1').classList.add('active');
      document.querySelectorAll('.step').forEach(step => step.style.display = 'none');
      document.querySelector('.step.active').style.display = 'block';
    });

    document.getElementById('prevStep3').addEventListener('click', function() {
      document.getElementById('step3').classList.remove('active');
      document.getElementById('step2').classList.add('active');
      document.querySelectorAll('.step').forEach(step => step.style.display = 'none');
      document.querySelector('.step.active').style.display = 'block';
    });

    // Add Another Pet
    document.getElementById('addPet').addEventListener('click', function() {
      petCount++;
      const petDiv = document.createElement('div');
      petDiv.className = 'pet-info mb-3';
      petDiv.innerHTML = `
        <label for="petName${petCount}" class="form-label">Pet Name</label>
        <input type="text" class="form-control" id="petName${petCount}" name="petName${petCount}" required>
        <label for="petAge${petCount}" class="form-label">Age</label>
        <input type="number" class="form-control" id="petAge${petCount}" name="petAge${petCount}">
        <label for="petWeight${petCount}" class="form-label">Weight <span class="text-danger">*</span></label>
        <input type="number" class="form-control" id="petWeight${petCount}" name="petWeight${petCount}" step="0.1" required>
        <label for="petNote${petCount}" class="form-label">Note (Medical Condition, Behavior)</label>
        <textarea class="form-control" id="petNote${petCount}" name="petNote${petCount}"></textarea>
      `;
      document.getElementById('petContainer').appendChild(petDiv);
    });

    // Calculate Total Price
    function updateTotalPrice() {
      const serviceType = document.querySelector('input[name="service_type"]:checked')?.value || 'washDry';
      const addOns = Array.from(document.querySelectorAll('input[name="add_ons"]:checked')).map(cb => cb.value);
      const basePrices = { washDry: 1800, washTidy: 2000, fullGroom: 2500, puppy: 2000 };
      const addOnPrices = { deshedding: 500, specialShampoo: 300, nailClip: 200, analGland: 400, teethBrushing: 300 };
      let total = basePrices[serviceType] || 0;
      addOns.forEach(add_on => total += addOnPrices[add_on] || 0);
      document.getElementById('totalPrice').textContent = `Rs. ${total.toFixed(2)}`;
    }

    document.querySelectorAll('input[name="service_type"], input[name="add_ons"]').forEach(input => {
      input.addEventListener('change', updateTotalPrice);
    });

    // Confirm Booking
    document.getElementById('confirmBooking').addEventListener('click', function() {
      const formData = new FormData(document.getElementById('bookingForm'));
      const data = {};
      for (let [key, value] of formData.entries()) {
        data[key] = value;
      }
      data.pets = [];
      for (let i = 1; i <= petCount; i++) {
        data.pets.push({
          name: data[`petName${i}`] || '',
          age: data[`petAge${i}`] || '',
          weight: data[`petWeight${i}`] || '',
          note: data[`petNote${i}`] || ''
        });
        delete data[`petName${i}`];
        delete data[`petAge${i}`];
        delete data[`petWeight${i}`];
        delete data[`petNote${i}`];
      }
      data.add_ons = Array.from(formData.getAll('add_ons'));
      data.date_time = new Date(document.getElementById('dateTime').value).toISOString();

      fetch('/book-appointment/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': '{{ csrf_token }}'
        },
        body: JSON.stringify(data)
      })
      .then(response => response.json())
      .then(result => {
        if (result.success) {
          alert('Booking confirmed! Redirecting to My Bookings...');
          window.location.href = '/my_bookings/';
        } else {
          alert('Error: ' + result.message);
        }
      })
      .catch(error => console.error('Error:', error));
    });
  });

  // Step styling
  document.querySelectorAll('.step').forEach(step => {
    step.style.display = 'none';
  });
  document.querySelector('.step.active').style.display = 'block';
</script>

<style>
  .step { display: none; }
  .step.active { display: block; }
</style>
{% endblock content %}